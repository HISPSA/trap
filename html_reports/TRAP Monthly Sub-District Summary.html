<html>

<head>

	<style>
		.MainTbl{
			border-left:2px solid #000;border-top:2px solid #000;border-right:2px solid #000;border-bottom:1px solid #000;
		}
		.SecondaryTbl{
			border-left:1px solid #000;border-top:1px solid #000;border-right:1px solid #000;
		}
		.labelHeader {
			font-weight:800;border-left:1px solid #000;border-bottom:1pt solid #000;text-align:center;padding:4px;
		}
		.labelmonthName{
			font-weight:800;border-left:1px solid #000;border-bottom:1pt solid #000;text-align:center;padding:4px;background-Color:#f5f5f5
		}
		.cellNumeric{
			text-align: right;padding:5px;
		}
		.rounded{
		    -webkit-border-radius: 4px 4px 4px 4px;
		    -moz-border-radius: 4px 4px 4px 4px;
		    border-radius: 4px 4px 4px 4px;
		}
	</style>

	<script language=javascript>

		function getParameterByName(name) {0
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}

		var ou = getParameterByName('ou');
		var pe = getParameterByName('pe');

	</script>

</head>

<body>

<div id="" style="padding:0">

<table border=0 cellpadding=0 cellspacing=0 style='min-width:75%;' id='tblMaster' class='MainTbl rounded'>
	<tr>
		<td colspan=1 class='labelHeader' style='border-left:0;'>{PLACEHOLDER}</td>
		<td colspan=1 class='labelHeader' id='1_peFprev'></td>
		<td colspan=1 class='labelHeader' id='1_peFtarget'></td>
		<td colspan=1 class='labelHeader' id='1_peFYTDtarget'></td>
		<td colspan=1 class='labelHeader' id='1_peFYTDactual'></td>
		<td colspan=1 class='labelHeader' id='1_peFYTDgap'></td>
		<td colspan=1 class='labelHeader' id='1_peFYTDprogress'></td>
		<td colspan=1 class='labelHeader' id='1_peMMtarget'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM04'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM05'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM06'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM07'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM08'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM09'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM10'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM11'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM12'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM01'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM02'></td>
		<td colspan=1 class='labelmonthName' id='1_peMM03'></td>
	</tr>
</table>

</div>

<input type="button" value="Export to Excel" id="exceldownloadbutton" name="exceldownloadbutton" onclick="javascript:fnExcelReport()" class="no-print" style="display:none;width:140px;position:absolute;left:306px;top:65px;">

 <script language=javascript>


	var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ];
	var dxCore = 'LHTsLNCZnlX,IpNKseiGOfP,KnQn2N452bE,Bmo4lk1FhgP,S6BlQpoZVhQ';
	var dxCat = 'wyZ6KAmjZeD,mLVlvjLwl9q';
	var dxCoreCat = '';
	var lblCat = 'Actual,Target';
	var dxRunningTotal = 'IpNKseiGOfP';
	var peMMrange = '';
	var peMMrangeEnd = '';
	var peMMlabelEnd = '';
	var peMMprevYRangeEnd = '';

	var sort_by = function(field, reverse, primer){
		var key = primer ? 
			function(x) {return primer(x[field])} : 
			function(x) {return x[field]};
		reverse = !reverse ? 1 : -1;
		return function (a, b) {
			return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
			} 
	}

	var peMcurr = parseInt(pe.substring(4,6));
	var peFcurr = parseInt(pe.substring(0,4));

	if (peMcurr <= 3){
		peFcurr = (peFcurr-1);
	}

	var peFprev = (peFcurr-1); //parseInt(((parseInt(peMcurr)<4) ? (peFcurr-1) : peFcurr));
	var peFcurrSuff = parseInt(peFcurr.toString().substring(2,4));
	var peFprevSuff = parseInt(peFprev.toString().substring(2,4));

	var peFYcurr = (peFcurr+'April');
	var peFYprev = (peFprev+'April');

	if (dxRunningTotal.length > 0) {
		peMMprevYRangeEnd = (peFcurr + '02');
	}

	document.getElementById('1_peFprev').innerHTML = (peFprev + '/' + peFcurrSuff + '<br>Baseline');
	document.getElementById('1_peFtarget').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>Target');
	document.getElementById('1_peFYTDtarget').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>YTD Target');
	document.getElementById('1_peFYTDactual').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>YTD Actual');
	document.getElementById('1_peFYTDgap').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>YTD Gap');
	document.getElementById('1_peFYTDprogress').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>YTD %<br>Progress');
	document.getElementById('1_peMMtarget').innerHTML = (peFcurr + '/' + ((peFcurrSuff)+1) + '<br>Monthly<br>Target');


	for (var p = 4; p <= 12; p++){
		document.getElementById('1_peMM' + paddNumeric(p,2)).innerHTML = ((months[p-1]).toString().substring(0,3)+'-'+peFcurrSuff);
		if ( (p > peMcurr) && (peMcurr > 4) ){
			document.getElementById('1_peMM' + paddNumeric(p,2)).style.display='none';
		} else {
			peMMrange += (peFcurr+paddNumeric(p,2)+';');
			peMMlabelEnd = ((months[p-1]).toString().substring(0,3)+'-'+peFcurrSuff);
			peMMrangeEnd = (peFcurr+paddNumeric(p,2));
		}
	}
	for (var p = 1; p <= 3; p++){
		document.getElementById('1_peMM' + paddNumeric(p,2)).innerHTML = ((months[p-1]).toString().substring(0,3)+'-'+(peFcurrSuff+1));
		if ( (peMcurr > 3) || (p > peMcurr) ){
			document.getElementById('1_peMM' + paddNumeric(p,2)).style.display='none';
		} else {
			peMMrange += ((peFcurr+1)+paddNumeric(p,2)+';');
			peMMlabelEnd = ((months[p-1]).toString().substring(0,3)+'-'+(peFcurrSuff+1));
			peMMrangeEnd = ((peFcurrSuff+1)+paddNumeric(p,2));
		}
	}

	var template1 = document.getElementById('tblMaster').outerHTML.replace('MainTbl','SecondaryTbl');

	document.getElementById('tblMaster').outerHTML = document.getElementById('tblMaster').outerHTML.replace('{PLACEHOLDER}',dhis2.report.organisationUnit.name)


	for (var p = 4; p <= 12; p++){
		document.getElementById('1_peMM' + paddNumeric(p,2)).innerHTML = ((months[p-1]).toString().substring(0,3)+'-'+peFcurrSuff);
	}
	for (var p = 1; p <= 3; p++){
		document.getElementById('1_peMM' + paddNumeric(p,2)).innerHTML = ((months[p-1]).toString().substring(0,3)+'-'+(peFcurrSuff+1));
	}

	var myCalcObj = [];

	//URL for Dx Core List
	var sDxCore = ('../api/dataElements.json?filter=id:in:['+dxCore+']&fields=id,name,shortName,displayName');

	 $.ajax({
		url: sDxCore,
		error: function (xhr, ajaxOptions, thrownError) {
			console.log('error: Data Element Lookup');
		},
		success : function(dataDE){

			var sort_by = function(field, reverse, primer){

			var key = primer ? 
				function(x) {return primer(x[field])} : 
				function(x) {return x[field]};

			reverse = !reverse ? 1 : -1;

			return function (a, b) {
				return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
				} 
			}

			var ArrDx = dxCore.split(',');
			var tbl1 = document.getElementById('tblMaster');

			for (var p = 0; p < dataDE.dataElements.length; p++){

				myCalcObj.push ({
					ou: ou,
					dx: dataDE.dataElements[p].id,
					YPrevactual: 0,
					YTDtarget: 0,
					YTDactual: 0,
					YTDgapNum: 0,
					YTDgapPer: 0,
					CALCtarget: 0,
					CALCactual: 0
				});

				var tr = document.createElement('tr');
				tbl1.appendChild(tr);

				var td = document.createElement('td');
				td.setAttribute("style",'padding:3px;border-bottom:1px solid #000;width:250px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;');
				td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_1');
				tr.appendChild(td);

				td.innerText = (dataDE.dataElements[p].name).replace('TRAP_','');

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				//td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_1');
				td.setAttribute("id",dataDE.dataElements[p].id+'.wyZ6KAmjZeD_'+ou+'_'+peFYprev);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				//td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_2');
				td.setAttribute("id",dataDE.dataElements[p].id+'.mLVlvjLwl9q_'+ou+'_'+peFYcurr);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				//td.setAttribute("storedValue",'');
				td.setAttribute("id",dataDE.dataElements[p].id+'.YTDtarget_'+ou+'_'+peFYcurr);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				//td.setAttribute("storedValue",'');
				td.setAttribute("id",dataDE.dataElements[p].id+'.YTDactual_'+ou+'_'+peFYcurr);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				td.setAttribute("id",dataDE.dataElements[p].id+'.DifferenceGap_'+ou+'_'+peFYcurr);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				//td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_6');
				td.setAttribute("id",dataDE.dataElements[p].id+'.DifferencePercentage_'+ou+'_'+peFYcurr);
				tr.appendChild(td);

				var td = document.createElement('td');
				td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
				td.setAttribute("class",'cellNumeric');
				td.setAttribute("id",dataDE.dataElements[p].id+'.mLVlvjLwl9q_'+ou+'_'+peMMrange.split(';')[0]);
				tr.appendChild(td);

				for (var r = 4; r <= 12; r++){
					if ( (r <= peMcurr) || (peMcurr <= 4) ){
						var td = document.createElement('td');
						td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;background-Color:#f5f5f5');
						td.setAttribute("class",'cellNumeric');
						//td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_MM_'+peFcurr+paddNumeric(r,2));
						td.setAttribute("id",dataDE.dataElements[p].id+'.wyZ6KAmjZeD_'+ou+'_'+peFcurr+paddNumeric(r,2));
						tr.appendChild(td);
					}
				}
				for (var r = 1; r <= 3; r++){
					if ( (r <= peMcurr) && (peMcurr <= 4) ){
						var td = document.createElement('td');
						td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;background-Color:#f5f5f5');
						td.setAttribute("class",'cellNumeric');
						//td.setAttribute("id",'1_'+dataDE.dataElements[p].id+'_MM_'+(peFcurr+1)+paddNumeric(r,2));
						td.setAttribute("id",dataDE.dataElements[p].id+'.wyZ6KAmjZeD_'+ou+'_'+(peFcurr+1)+paddNumeric(r,2));
						tr.appendChild(td);
					}
				}

			}

			var dv = document.createElement('div');
			dv.setAttribute('style','padding:8px 0 8px 0;');
			dv.innerText = 'Table 1. Monthly sub-district summary for financial year F' + peFcurr + ' ('+dhis2.report.organisationUnit.name+', period ending ' + peMMlabelEnd + ')';
			document.getElementById('mainPage').appendChild(dv);

			var dxArrCore = dxCore.split(',')
			var dxArrCat = dxCat.split(',')

			for (var n = 0; n < dxArrCore.length; n++){
				for (var o = 0; o < dxArrCat.length; o++){
					dxCoreCat += (dxArrCore[n]+'.'+dxArrCat[o]+';');
				}
			}

			dxCoreCat = dxCoreCat.substring(dxCoreCat,dxCoreCat.length-1);

			//URL for parent-OU 
			var sOU = ('../api/organisationUnits/' + ou + '.json?fields=id,name,displayName,displayShortName,children[id,name,displayName,displayShortName]');

			$.ajax({
				url: sOU,
				error: function (xhr, ajaxOptions, thrownError) {
					console.log('error: Data Element Lookup');
				},
				success : function(dataOU){

					var OUchildren = '';

					for (var p = 0; p < dataOU.children.length; p++){
						OUchildren += (dataOU.children[p].id + ';');
					}

					OUchildren = OUchildren.substring(OUchildren,OUchildren.length-1);

					for (var n = 0; n < dataDE.dataElements.length; n++){

						var dv = document.createElement('div');
						dv.setAttribute('id','dv_'+dataDE.dataElements[n].id);
						dv.setAttribute('style','padding:8px 0 8px 0;');
						document.getElementById('mainPage').appendChild(dv);

						dv.innerHTML = (template1.replace('tblMaster','tblDx_'+dataDE.dataElements[n].id));
						dv.innerHTML = (dv.innerHTML).replace('{PLACEHOLDER}',dataDE.dataElements[n].name).replace('TRAP_','');

						var tbl1 = document.getElementById('tblDx_'+dataDE.dataElements[n].id);

						for (var p = 0; p < dataOU.children.length; p++){

							myCalcObj.push ({
								ou: dataOU.children[p].id,
								dx: dataDE.dataElements[n].id,
								YPrevactual: 0,
								YTDtarget: 0,
								YTDactual: 0,
								YTDgapNum: 0,
								YTDgapPer: 0,
								CALCtarget: 0,
								CALCactual: 0
							});
							
							var tr = document.createElement('tr');
							tbl1.appendChild(tr);

							var td = document.createElement('td');
							td.setAttribute("style",'padding:3px;border-bottom:1px solid #000;width:250px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;');
							td.setAttribute("id",dataDE.dataElements[n].id+'_'+dataOU.children[p].id+'_0');
							tr.appendChild(td);

							td.innerText = (dataOU.children[p].name);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							td.setAttribute("id",dataDE.dataElements[n].id+'.wyZ6KAmjZeD_'+dataOU.children[p].id+'_'+peFYprev);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							//td.setAttribute("id",dataDE.dataElements[n].id+'_'+dataOU.children[p].id+'_2');
							td.setAttribute("id",dataDE.dataElements[n].id+'.mLVlvjLwl9q_'+dataOU.children[p].id+'_'+peFYcurr);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							td.setAttribute("id",dataDE.dataElements[n].id+'.YTDtarget_'+dataOU.children[p].id+'_'+peFYcurr);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							td.setAttribute("id",dataDE.dataElements[n].id+'.YTDactual_'+dataOU.children[p].id+'_'+peFYcurr);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							td.setAttribute("id",dataDE.dataElements[n].id+'.DifferenceGap_'+dataOU.children[p].id+'_'+peFYcurr);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							//td.setAttribute("id",dataDE.dataElements[n].id+'_'+dataOU.children[p].id+'_6');
							td.setAttribute("id",dataDE.dataElements[n].id+'.DifferencePercentage_'+dataOU.children[p].id+'_'+peFYcurr);
							tr.appendChild(td);

							var td = document.createElement('td');
							td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;');
							td.setAttribute("class",'cellNumeric');
							td.setAttribute("id",dataDE.dataElements[n].id+'.mLVlvjLwl9q_'+dataOU.children[p].id+'_'+peMMrange.split(';')[0]);
							tr.appendChild(td);

							for (var r = 4; r <= 12; r++){
								if ( (r <= peMcurr) || (peMcurr <= 4) ){
									var td = document.createElement('td');
									td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;background-Color:#f5f5f5');
									td.setAttribute("class",'cellNumeric');
									td.setAttribute("id",dataDE.dataElements[n].id+'.wyZ6KAmjZeD_'+dataOU.children[p].id+'_'+peFcurr+paddNumeric(r,2));
									tr.appendChild(td);
								}
							}
							for (var r = 1; r <= 3; r++){
								if ( (r <= peMcurr) && (peMcurr <= 4) ){
									var td = document.createElement('td');
									td.setAttribute("style",'border-bottom:1px solid #000;border-left:1px solid #000;background-Color:#f5f5f5');
									td.setAttribute("class",'cellNumeric');
									td.setAttribute("id",dataDE.dataElements[n].id+'.wyZ6KAmjZeD_'+dataOU.children[p].id+'_'+(peFcurr+1)+paddNumeric(r,2));
									tr.appendChild(td);
								}
							}

						}

						var dv1 = document.createElement('div');
						dv1.setAttribute('style','padding:8px 0 8px 0;');
						dv1.innerText = 'Table '+(n+2)+'. Facility totals for ['+(dataDE.dataElements[n].name).replace('TRAP_','')+']';
						dv.appendChild(dv1);

					}

					var sDataGet = '../api/26/analytics.json?dimension=dx:'+dxCore.replace(',',';')+';'+dxCoreCat+'&dimension=pe:'+( (peMMprevYRangeEnd.length > 0) ? (peMMprevYRangeEnd + ';') : '' )+peMMrange+peFYcurr+';'+peFYprev+'&dimension=ou:'+ou+';'+OUchildren+'&displayProperty=NAME&outputIdScheme=UID';
					console.log(sDataGet);

					$.ajax({
						url: sDataGet,
						error: function (xhr, ajaxOptions, thrownError) {
							console.log('error: getting report data values');
						},
						success : function(dataVal){

							var comboRESULT = [];

							for (var i = 0; i < dataVal.rows.length; i++){

								var myRowID = (dataVal.rows[i][0] + '_' + dataVal.rows[i][2] + '_' + dataVal.rows[i][1]);
								var myValue = dataVal.rows[i][3];

								comboRESULT.push ({ id: myRowID, value: myValue });

								try {
									document.getElementById(myRowID).innerText = formatNumber(parseFloat(myValue).toFixed(1).toString().replace('.0',''));
								}
								catch(err) {
									//console.log('No match: '+myRowID +': ['+myValue+']')
								}

							}

							var PEarr = peMMrange.substring(peMMrange,peMMrange.length-1).split(';')

							for (var a = 0; a < myCalcObj.length; a++){

								for (var i = 0; i < comboRESULT.length; i++){

									if ( ( (comboRESULT[i].id).indexOf(myCalcObj[a].dx) >= 0) && ( (comboRESULT[i].id).indexOf(myCalcObj[a].ou) >= 0) ){

										if ( (dxRunningTotal).indexOf(myCalcObj[a].dx) >= 0){

											// Is RunningTotal dxUID in current row AND appropriate PE value in current row? then assign [end of prev-year-MM] value
											if ( ( (comboRESULT[i].id).indexOf(peMMprevYRangeEnd) >= 0) ) {
												myCalcObj[a].YPrevactual = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}
											// Is RunningTotal dxUID in current row AND appropriate PE value in current row
											if ( (comboRESULT[i].id).indexOf(peMMrangeEnd) >= 0) {
												if ( (comboRESULT[i].id).indexOf('mLVlvjLwl9q') >= 0 )  {
													myCalcObj[a].YTDtarget = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
												}
												if ( (comboRESULT[i].id).indexOf('wyZ6KAmjZeD') >= 0 )  {
													myCalcObj[a].YTDactual = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
												}
											}

										} else {

											if ( ( (comboRESULT[i].id).indexOf(peFYprev) >= 0) ) {
												myCalcObj[a].YPrevactual = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}
											if ( ( (comboRESULT[i].id).indexOf('mLVlvjLwl9q') >= 0) && ( (comboRESULT[i].id).indexOf(peFYcurr) >= 0) ) {
												myCalcObj[a].YTDtarget = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}
											if ( ( (comboRESULT[i].id).indexOf('wyZ6KAmjZeD') >= 0) && ( (comboRESULT[i].id).indexOf(peFYcurr) >= 0) ) {
												myCalcObj[a].YTDactual = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}

										}


										for (var p = 0; p < PEarr.length; p++){
											// YTD CALC of TARGET
											if ( ( (comboRESULT[i].id).indexOf('.mLVlvjLwl9q') >= 0) && ((comboRESULT[i].id).indexOf(PEarr[p]) >= 0) ) {
												myCalcObj[a].CALCtarget += (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}
											// YTD CALC of ACTUAL
											if ( ( (comboRESULT[i].id).indexOf('.wyZ6KAmjZeD') >= 0) && ((comboRESULT[i].id).indexOf(PEarr[p]) >= 0) ) {
												myCalcObj[a].CALCactual += (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
											}
										}


										if ( (dxRunningTotal).indexOf(myCalcObj[a].dx) >= 0){
											if ( (comboRESULT[i].id).indexOf(peMMrangeEnd) >= 0) {
												if ( (comboRESULT[i].id).indexOf('mLVlvjLwl9q') >= 0 )  {
													// RUN AFTER CALCtarget added together
													myCalcObj[a].CALCtarget = (isNumber(comboRESULT[i].value) ? parseFloat(comboRESULT[i].value) : 0);
												}
											}
										}

									}

								}

							}

							for (var a = 0; a < myCalcObj.length; a++){

								//myCalcObj[a].YTDgapNum = ( parseFloat(myCalcObj[a].YTDtarget) - parseFloat(myCalcObj[a].YTDactual) );
								//myCalcObj[a].YTDgapPer = ( parseFloat(myCalcObj[a].YTDactual) / parseFloat(myCalcObj[a].YTDtarget) * 100 ).toFixed(1);


								document.getElementById(myCalcObj[a].dx+'.wyZ6KAmjZeD_'+myCalcObj[a].ou+'_'+peFYprev).innerText = formatNumber( parseFloat(myCalcObj[a].YPrevactual) );
								document.getElementById(myCalcObj[a].dx+'.mLVlvjLwl9q_'+myCalcObj[a].ou+'_'+peFYcurr).innerText = formatNumber( parseFloat(myCalcObj[a].YTDtarget) );
								document.getElementById(myCalcObj[a].dx+'.YTDtarget_'+myCalcObj[a].ou+'_'+peFYcurr).innerText = formatNumber( parseFloat(myCalcObj[a].CALCtarget) );
								document.getElementById(myCalcObj[a].dx+'.YTDactual_'+myCalcObj[a].ou+'_'+peFYcurr).innerText = formatNumber( parseFloat(myCalcObj[a].CALCactual) );
								document.getElementById(myCalcObj[a].dx+'.DifferenceGap_'+myCalcObj[a].ou+'_'+peFYcurr).innerText = formatNumber( parseFloat(myCalcObj[a].CALCactual) - parseFloat(myCalcObj[a].CALCtarget) );


								if (myCalcObj[a].CALCtarget > 0) {
									document.getElementById(myCalcObj[a].dx+'.DifferencePercentage_'+myCalcObj[a].ou+'_'+peFYcurr).innerText = formatNumber( (parseFloat(myCalcObj[a].CALCactual) / parseFloat(myCalcObj[a].CALCtarget) * 100 ).toFixed(1)) + '%';
									document.getElementById(myCalcObj[a].dx+'.DifferencePercentage_'+myCalcObj[a].ou+'_'+peFYcurr).style.backgroundColor = getBackgroundPerformanceColor((parseFloat(myCalcObj[a].CALCactual) / parseFloat(myCalcObj[a].CALCtarget) * 100 ));;
								}

							}

						}
					});

				}

			});

		}
	
	 })

	function getBackgroundPerformanceColor(varVal){
		if (isNumber(varVal)) {
			if (parseFloat(varVal) > 110){
				return '#656AFC'; // blue
			}
			if ( (parseFloat(varVal) >= 95) && (parseFloat(varVal) <= 110) ){
				return '#90FC65'; // green
			}
			if ( (parseFloat(varVal) >= 80) && (parseFloat(varVal) < 95) ){
				return '#FCDC65'; // orange
			}
			if (parseFloat(varVal) < 80){
				return '#FC6565'; // red
			}
		}
	}

	function paddNumeric(varVal,iPadd){
		var sPadd = '';
		for (var i = (varVal.toString().length); i < iPadd; i++){
			sPadd += '0';
		}
		return (sPadd.toString() + varVal.toString());
	}

	function isNumber(n) {
		return !isNaN(parseFloat(n)) && isFinite(n);
	}

	function returnAttributeValue(Arr,sName,ReturnDefault){
		var sReturn = '';
		for(var i = 0; i < Arr.length; i++) {
			if (Arr[i].attribute.name == sName){
				sReturn = Arr[i].value;
			}
		}
		if (sReturn.length == 0){
			return ReturnDefault
		}
		else{
			return sReturn
		}
	}

	function formatNumber(num) {
		return ("" + num).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, function($1) { return $1 + "," });
	}

	function fnExcelReport(){

		var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
		var textRange; var j=0;
		tab = document.getElementById('tblMaster'); // id of table

		for(j = 0 ; j < tab.rows.length ; j++) {     
			tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
			//tab_text=tab_text+"</tr>";
		}

		tab_text=tab_text+"</table>";
		tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
		tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
		tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

		var ua = window.navigator.userAgent;
		var msie = ua.indexOf("MSIE "); 

		//link.download = "QPR_HEALTH_" + document.getElementById('ouvalue').innerHTML + "_" + (document.getElementById('peFprev').innerHTML).replace('/','_') + "_fQ" + (document.getElementById('peFq').innerHTML).substring(0,1) + ".xls";
		if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {     // If Internet Explorer
			txtArea1.document.open("txt/html","replace");
			txtArea1.document.write(tab_text);
			txtArea1.document.close();
			txtArea1.focus(); 
			sa=txtArea1.document.execCommand("SaveAs",true,"Say Thanks to Sumit.xls");
		} else {                //other browser not tested on IE 11
			sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text)); 
		}

		return (sa);
	}

</script>

</body>
</html>